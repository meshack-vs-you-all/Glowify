{%- comment -%}
  Structured Data (Schema.org) for SEO
  Usage: {% render 'structured-data', type: 'product', product: product %}
  Types: product, collection, organization, breadcrumb
{%- endcomment -%}

{%- case type -%}
  {%- when 'product' -%}
    {%- if product -%}
      <script type="application/ld+json">
      {
        "@context": "https://schema.org/",
        "@type": "Product",
        "name": {{ product.title | json }},
        "image": [
          {%- for image in product.images limit: 5 -%}
            "{{ image | image_url: width: 1200 }}"{% unless forloop.last %},{% endunless %}
          {%- endfor -%}
        ],
        "description": {{ product.description | strip_html | truncate: 200 | json }},
        "sku": "{{ product.selected_or_first_available_variant.sku }}",
        "mpn": "{{ product.selected_or_first_available_variant.barcode }}",
        "brand": {
          "@type": "Brand",
          "name": {{ shop.name | json }}
        },
        "offers": {
          "@type": "Offer",
          "url": "{{ shop.url }}{{ product.url }}",
          "priceCurrency": "{{ cart.currency.iso_code }}",
          "price": "{{ product.selected_or_first_available_variant.price | money_without_currency | remove: ',' }}",
          "priceValidUntil": "{{ 'now' | date: '%s' | plus: 31536000 | date: '%Y-%m-%d' }}",
          "itemCondition": "https://schema.org/NewCondition",
          "availability": "https://schema.org/{% if product.selected_or_first_available_variant.available %}InStock{% else %}OutOfStock{% endif %}",
          "seller": {
            "@type": "Organization",
            "name": {{ shop.name | json }}
          }
        }
        {%- if product.vendor != blank -%}
        ,"manufacturer": {
          "@type": "Organization",
          "name": {{ product.vendor | json }}
        }
        {%- endif -%}
      }
      </script>
    {%- endif -%}
  {%- when 'collection' -%}
    {%- if collection -%}
      <script type="application/ld+json">
      {
        "@context": "https://schema.org/",
        "@type": "CollectionPage",
        "name": {{ collection.title | json }},
        "description": {{ collection.description | strip_html | json }},
        "url": "{{ shop.url }}{{ collection.url }}"
      }
      </script>
    {%- endif -%}
  {%- when 'organization' -%}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org/",
      "@type": "Organization",
      "name": {{ shop.name | json }},
      "url": "{{ shop.url }}",
      "logo": "{{ shop.brand.logo | image_url: width: 200 }}",
      "sameAs": [
        {%- if section.settings.facebook_url != blank -%}"{{ section.settings.facebook_url }}"{%- endif -%}
        {%- if section.settings.instagram_url != blank -%},"{{ section.settings.instagram_url }}"{%- endif -%}
        {%- if section.settings.twitter_url != blank -%},"{{ section.settings.twitter_url }}"{%- endif -%}
        {%- if section.settings.youtube_url != blank -%},"{{ section.settings.youtube_url }}"{%- endif -%}
        {%- if section.settings.tiktok_url != blank -%},"{{ section.settings.tiktok_url }}"{%- endif -%}
      ]
    }
    </script>
  {%- when 'breadcrumb' -%}
    {%- if breadcrumbs -%}
      <script type="application/ld+json">
      {
        "@context": "https://schema.org/",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "{{ shop.url }}"
          }
          {%- for crumb in breadcrumbs -%}
          ,{
            "@type": "ListItem",
            "position": {{ forloop.index | plus: 1 }},
            "name": {{ crumb.title | json }},
            "item": "{{ shop.url }}{{ crumb.url }}"
          }
          {%- endfor -%}
        ]
      }
      </script>
    {%- endif -%}
  {%- when 'website' -%}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org/",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "url": "{{ shop.url }}",
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "{{ shop.url }}/search?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    }
    </script>
{%- endcase -%}

