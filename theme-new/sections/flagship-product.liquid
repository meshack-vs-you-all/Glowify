{%- comment -%}
  Flagship Product Section
  Highlights a single key product with features.
  Mobile-First: Image -> Title -> Price -> Features -> CTA
{%- endcomment -%}

{%- assign selected_product = section.settings.product -%}

{%- comment -%} Fallback: Find highest priced product if none selected {%- endcomment -%}
{%- if selected_product == blank -%}
  {%- assign all_products = collections.all.products | sort: 'price' -%}
  {%- assign selected_product = all_products | last -%}
{%- endif -%}

{%- if selected_product != blank -%}
  <section class="section flagship-product" id="flagship-{{ section.id }}">
    <div class="page-width">
      <div class="flagship-grid">
        <!-- Media Column -->
        <div class="flagship-media">
          <div class="flagship-image-wrapper">
            {%- if selected_product.featured_image != blank -%}
              <img 
                src="{{ selected_product.featured_image | image_url: width: 800 }}" 
                alt="{{ selected_product.featured_image.alt | default: selected_product.title | escape }}" 
                loading="lazy"
                width="800"
                height="800"
                class="flagship-img"
              >
            {%- else -%}
              {{ 'product-1' | placeholder_svg_tag: 'flagship-img' }}
            {%- endif -%}
            <div class="flagship-badge">{{ section.settings.badge_text | default: 'Best Seller' }}</div>
          </div>
        </div>

        <!-- Content Column -->
        <div class="flagship-content">
          <span class="flagship-preheader">{{ section.settings.subheading | default: 'The Ultimate Choice' }}</span>
          <h2 class="flagship-title">{{ selected_product.title }}</h2>
          <div class="flagship-price">{{ selected_product.price | money }}</div>
          
          <div class="flagship-description">
            {{ selected_product.description | strip_html | truncatewords: 30 }}
          </div>

          <ul class="flagship-features">
            {%- for i in (1..3) -%}
              {%- capture feature_text_key -%}feature_{{ i }}_text{%- endcapture -%}
              {%- assign feature_text = section.settings[feature_text_key] -%}
              {%- if feature_text != blank -%}
                <li class="flagship-feature">
                  <svg class="feature-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                  {{ feature_text }}
                </li>
              {%- endif -%}
            {%- endfor -%}
            
            {%- comment -%} Auto-generated features if empty {%- endcomment -%}
            {%- if section.settings.feature_1_text == blank and section.settings.feature_2_text == blank -%}
               <li class="flagship-feature">
                  <svg class="feature-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                  Premium Quality Materials
               </li>
               <li class="flagship-feature">
                  <svg class="feature-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                  {{ selected_product.vendor | default: 'Expertly Crafted' }}
               </li>
            {%- endif -%}
          </ul>

          <div class="flagship-actions">
            <!-- Signature Interaction: Soft Pulse on CTA -->
            <a href="{{ selected_product.url }}" class="button button--primary flagship-btn pulse-soft">Shop Now</a>
            {%- if section.settings.show_view_details -%}
              <a href="{{ selected_product.url }}" class="button button--secondary flagship-btn">View Details</a>
            {%- endif -%}
          </div>
        </div>
      </div>
    </div>
  </section>
{%- endif -%}

<style>
  .flagship-product {
    padding: 4rem 0;
    background: #fff;
  }

  .flagship-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 3rem;
    align-items: center;
  }

  @media (min-width: 990px) {
    .flagship-grid {
      grid-template-columns: 1fr 1fr;
      gap: 5rem;
    }
  }

  /* Media */
  .flagship-image-wrapper {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    background: #f5f5f5;
    aspect-ratio: 1;
    box-shadow: 0 20px 40px -4px rgba(0,0,0,0.1); /* Premium Lift */
  }

  .flagship-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.7s ease;
  }
  
  .flagship-image-wrapper:hover .flagship-img {
    transform: scale(1.05); /* Subtle zoom */
  }

  .flagship-badge {
    position: absolute;
    top: 1rem;
    left: 1rem;
    background: #7C9885; /* Sage green accent */
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 100px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    z-index: 2;
  }

  /* Content */
  .flagship-preheader {
    display: block;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
  }

  .flagship-title {
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.1;
    margin-bottom: 1rem;
    color: #1a1a1a;
    font-family: var(--font-heading-family);
  }

  .flagship-price {
    font-size: 1.5rem;
    font-weight: 600;
    color: #7C9885;
    margin-bottom: 1.5rem;
  }

  .flagship-description {
    font-size: 1.1rem;
    line-height: 1.6;
    color: #4a4a4a;
    margin-bottom: 2rem;
  }

  /* Features */
  .flagship-features {
    list-style: none;
    padding: 0;
    margin: 0 0 2.5rem 0;
  }

  .flagship-feature {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    font-size: 1rem;
    color: #1a1a1a;
  }

  .feature-icon {
    width: 20px;
    height: 20px;
    color: #7C9885;
  }

  /* Actions */
  .flagship-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .flagship-btn {
    min-width: 160px;
  }
</style>

{% schema %}
{
  "name": "Flagship Product",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product",
      "info": "Leave empty to auto-select the highest priced product."
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "The Ultimate Choice"
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Badge Text",
      "default": "Best Seller"
    },
    {
      "type": "header",
      "content": "Features"
    },
    {
      "type": "text",
      "id": "feature_1_text",
      "label": "Feature 1"
    },
    {
      "type": "text",
      "id": "feature_2_text",
      "label": "Feature 2"
    },
    {
      "type": "checkbox",
      "id": "show_view_details",
      "label": "Show 'View Details' button",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Flagship Product"
    }
  ]
}
{% endschema %}
