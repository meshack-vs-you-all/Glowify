{%- comment -%}
  Premium Product Page - Editorial Layout
  Features: Sticky Gallery, Calm Typography, Progressive Disclosure (Accordions)
{%- endcomment -%}

{{ 'product.css' | asset_url | stylesheet_tag }}
<script src="{{ 'product.js' | asset_url }}" defer="defer"></script>

<div class="product-page section" data-section-id="{{ section.id }}" data-product-id="{{ product.id }}">
  <div class="page-width">
    <!-- Breadcrumbs (Minimal) -->
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <ol class="breadcrumbs__list">
        <li class="breadcrumbs__item"><a href="{{ routes.root_url }}">Home</a></li>
        {%- if collection -%}
          <li class="breadcrumbs__item"><a href="{{ collection.url }}">{{ collection.title }}</a></li>
        {%- endif -%}
        <li class="breadcrumbs__item" aria-current="page">{{ product.title }}</li>
      </ol>
    </nav>

    <div class="product-layout">
      <!-- Gallery Column (Left) -->
      <div class="product-gallery__wrapper">
        <div class="product-gallery sticky-gallery">
          <div class="product-gallery__main" data-gallery-main>
            {%- if product.featured_image -%}
              <div class="product-gallery__image-container">
                <img 
                  src="{{ product.featured_image | image_url: width: 1400 }}"
                  alt="{{ product.featured_image.alt | escape }}"
                  loading="eager"
                  class="product-gallery__image"
                  data-main-image
                >
              </div>
            {%- endif -%}
          </div>
          
          <!-- Thumbnails (Editorial Grid) -->
          {%- if product.images.size > 1 -%}
            <div class="product-gallery__thumbs">
              {%- for image in product.images -%}
                <button 
                  class="product-gallery__thumb {% if forloop.first %}active{% endif %}"
                  data-thumbnail-id="{{ image.id }}"
                  data-image-url="{{ image | image_url: width: 1400 }}"
                  aria-label="View Image {{ forloop.index }}"
                >
                  <img src="{{ image | image_url: width: 120 }}" alt="{{ image.alt | escape }}" loading="lazy">
                </button>
              {%- endfor -%}
            </div>
          {%- endif -%}
        </div>
      </div>

      <!-- Info Column (Right) -->
      <div class="product-info__wrapper">
        <div class="product-info">
          
          <!-- Header Block -->
          <div class="product-header">
            {%- if section.settings.show_vendor -%}
              <div class="product-vendor">{{ product.vendor }}</div>
            {%- endif -%}
            
            <h1 class="product-title">{{ product.title }}</h1>
            
            <div class="product-price-container">
              <div class="product-price">
                {%- if product.compare_at_price > product.price -%}
                  <span class="price price--sale">{{ product.price | money }}</span>
                  <span class="price price--compare">{{ product.compare_at_price | money }}</span>
                {%- else -%}
                  <span class="price">{{ product.price | money }}</span>
                {%- endif -%}
              </div>
              
              <!-- Review Badge (Subtle) -->
              {%- if section.settings.show_reviews -%}
                <div class="product-reviews-badge">
                  <span class="stars">★★★★★</span>
                  <span class="text">4.9 (128 reviews)</span>
                </div>
              {%- endif -%}
            </div>
          </div>

          <!-- Product Form -->
          {%- form 'product', product, class: 'product-form' -%}
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
            
            <!-- Variants -->
            {%- unless product.has_only_default_variant -%}
              <div class="product-options">
                {%- for option in product.options_with_values -%}
                  {%- if option.name == 'Color' or option.name == 'Colour' -%}
                    <div class="option-group option-group--color">
                      <label class="option-label">
                        Color: <span class="option-current-value">{{ option.selected_value }}</span>
                      </label>
                      <div class="option-values">
                        {%- for value in option.values -%}
                          <label class="color-swatch {% if option.selected_value == value %}active{% endif %}">
                            <input type="radio" name="options[{{ option.name }}]" value="{{ value }}" {% if option.selected_value == value %}checked{% endif %}>
                            <span class="swatch-visual" {% render 'color-swatch', value: value %}></span>
                          </label>
                        {%- endfor -%}
                      </div>
                    </div>
                  {%- else -%}
                     <div class="option-group">
                       <div class="option-header">
                         <label class="option-label">{{ option.name }}</label>
                         {%- if option.name == 'Size' -%}
                           <button type="button" class="size-guide-btn" data-modal="size-guide">Size Guide</button>
                         {%- endif -%}
                       </div>
                       <div class="option-chips">
                         {%- for value in option.values -%}
                           <label class="chip-label {% if option.selected_value == value %}active{% endif %}">
                             <input type="radio" name="options[{{ option.name }}]" value="{{ value }}" {% if option.selected_value == value %}checked{% endif %}>
                             <span class="chip-text">{{ value }}</span>
                           </label>
                         {%- endfor -%}
                       </div>
                     </div>
                  {%- endif -%}
                {%- endfor -%}
              </div>
            {%- endunless -%}

            <!-- Actions -->
            <div class="product-actions">
              <div class="quantity-wrapper" data-quantity-wrapper>
                <label class="quantity-label">Quantity</label>
                <div class="quantity-selector">
                  <button type="button" class="qty-btn" data-action="decrease">-</button>
                  <input type="number" name="quantity" value="1" min="1" class="qty-input">
                  <button type="button" class="qty-btn" data-action="increase">+</button>
                </div>
              </div>
              
              <button 
                type="submit" 
                name="add" 
                class="button button--primary add-to-cart-btn"
                {% unless product.available %}disabled{% endunless %}
              >
                {%- if product.available -%}
                  <span>Add to Bag</span>
                  <span class="separator">•</span>
                  <span class="btn-price">{{ product.price | money }}</span>
                {%- else -%}
                  Sold Out
                {%- endif -%}
              </button>
            </div>

            <!-- Reassurance -->
            <div class="product-reassurance">
              <div class="reassurance-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                <span>Ships within 24 hours</span>
              </div>
              <div class="reassurance-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
                <span>Free returns & exchanges</span>
              </div>
            </div>
          {%- endform -%}

          <!-- Content Accordions (Progressive Disclosure) -->
          <div class="product-accordions">
            <!-- Description -->
            <details class="accordion-item" open>
              <summary class="accordion-header">
                <span>Description</span>
                <span class="icon">+</span>
              </summary>
              <div class="accordion-content">
                {{ product.description }}
              </div>
            </details>
            
            <!-- Features (Dynamic) -->
            {%- if section.blocks.size > 0 -%}
              <details class="accordion-item">
                <summary class="accordion-header">
                  <span>Features & Benefits</span>
                  <span class="icon">+</span>
                </summary>
                <div class="accordion-content">
                  <ul class="features-list">
                    {%- for block in section.blocks -%}
                      {%- if block.type == 'feature' -%}
                        <li><strong>{{ block.settings.title }}:</strong> {{ block.settings.text }}</li>
                      {%- endif -%}
                    {%- endfor -%}
                  </ul>
                </div>
              </details>
            {%- endif -%}
            
            <!-- Shipping -->
            <details class="accordion-item">
              <summary class="accordion-header">
                <span>Shipping & Delivery</span>
                <span class="icon">+</span>
              </summary>
              <div class="accordion-content">
                <p>Free shipping on orders over $50. All orders ship within 1-2 business days via FedEx or UPS Ground.</p>
              </div>
            </details>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Editorial Product Page",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Vendor",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_reviews",
      "label": "Show Review Badge",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature Point",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Material"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Description",
          "default": "100% Organic Cotton"
        }
      ]
    }
  ]
}
{% endschema %}
